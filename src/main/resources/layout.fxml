<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ColorPicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollBar?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Slider?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.ToggleButton?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.canvas.Canvas?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.Region?>

<?import javafx.scene.control.ProgressIndicator?>
<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.ssltrainingplatform.controller.EditorController" style="-fx-background-color: #111;">

    <top>
        <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-background-color: #1e1e1e; -fx-padding: 10; -fx-border-color: #000; -fx-border-width: 0 0 1 0;">
            <children>

                <HBox alignment="CENTER" spacing="10" style="-fx-background-color: #2a2a2a; -fx-background-radius: 20; -fx-padding: 5 15;">
                    <ColorPicker fx:id="colorPicker" style="-fx-color-label-visible: false; -fx-background-color: transparent; -fx-max-width: 40;" />
                    <Slider fx:id="sizeSlider" min="5" max="100" value="20" prefWidth="80" blockIncrement="5" />
                </HBox>

                <Separator orientation="VERTICAL" />

                <HBox spacing="5" style="-fx-background-color: #2a2a2a; -fx-background-radius: 5; -fx-padding: 2;">
                    <Button fx:id="btnUndo" onAction="#onUndo" text="" style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-size: 14;" />
                    <Button fx:id="btnRedo" onAction="#onRedo" text="" style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-size: 14;" />
                </HBox>

                <HBox spacing="5" style="-fx-background-color: #2a2a2a; -fx-background-radius: 5; -fx-padding: 2;">
                    <ToggleButton fx:id="btnCursor" onAction="#setToolCursor" text="" selected="true" style="-fx-background-radius: 5;">
                        <toggleGroup>
                            <ToggleGroup fx:id="toolsGroup"/>
                        </toggleGroup>
                    </ToggleButton>
                    <ToggleButton fx:id="btnPen" onAction="#setToolPen" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnText" onAction="#setToolText" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                </HBox>

                <HBox spacing="5" style="-fx-background-color: #2a2a2a; -fx-background-radius: 5; -fx-padding: 2;">
                    <ToggleButton fx:id="btnArrow" onAction="#setToolArrow" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnArrowDashed" onAction="#setToolArrowDashed" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnArrow3D" onAction="#setToolArrow3D" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />

                    <ToggleButton fx:id="btnSpotlight" onAction="#setToolSpotlight" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnBase" onAction="#setToolBase" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnWall" onAction="#setToolWall" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnRectShaded" onAction="#setToolRectShaded" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnPolygon" onAction="#setToolPolygon" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnCurve" onAction="#setToolCurve" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                </HBox>

                <HBox spacing="5" style="-fx-background-color: #2a2a2a; -fx-background-radius: 5; -fx-padding: 2;">
                    <ToggleButton fx:id="btnZoomCircle" onAction="#setToolZoomCircle" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                    <ToggleButton fx:id="btnZoomRect" onAction="#setToolZoomRect" text="" toggleGroup="$toolsGroup" style="-fx-background-radius: 5;" />
                </HBox>

                <Region HBox.hgrow="ALWAYS" />

                <Button text="EXPORTAR MP4" onAction="#onExportVideo" style="-fx-background-color: #16a34a; -fx-text-fill: white; -fx-font-weight: bold;" />
            </children>
        </HBox>
    </top>

    <center>
        <StackPane fx:id="container" style="-fx-background-color: #000;" minWidth="0" minHeight="0">

            <ImageView fx:id="videoView" preserveRatio="true" />
            <Canvas fx:id="drawCanvas" />

            <TextField fx:id="floatingInput" visible="false" style="-fx-background-color: rgba(0,0,0,0.7); -fx-text-fill: yellow; -fx-border-color: yellow; -fx-border-radius: 5;" maxWidth="200" />
        </StackPane>
    </center>

    <bottom>
        <VBox style="-fx-background-color: #111; -fx-padding: 10;" BorderPane.alignment="CENTER" spacing="10">
            <children>
                <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-padding: 10; -fx-background-color: #2b2b2b; -fx-background-radius: 10;">
                    <children>
                        <Button onAction="#onImportVideo" text="Importar Video" style="-fx-background-color: #6366f1; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5;" />

                        <Separator orientation="VERTICAL" />

                        <Button onAction="#onCaptureFrame" text="ðŸ“· Capturar" style="-fx-background-color: #00bcd4; -fx-text-fill: white; -fx-background-radius: 5; -fx-font-weight: bold;" />
                        <Button onAction="#onCutVideo" text="âœ‚ Cortar" style="-fx-background-color: #ff9900; -fx-text-fill: black; -fx-font-weight: bold; -fx-background-radius: 5;" />
                        <Button onAction="#onDeleteSegment" text="ðŸ—‘ Borrar" style="-fx-background-color: #cc0000; -fx-text-fill: white; -fx-background-radius: 5;" />

                        <Separator orientation="VERTICAL" />

                        <ToggleButton fx:id="btnToggleAI" text="ðŸ¤– IA Overlay" style="-fx-base: #444; -fx-background-radius: 5;" />

                        <Button text="Guardar AnÃ¡lisis" onAction="#onSaveFrame">
                            <graphic>
                                <StackPane fx:id="iconSaveContainer" />
                            </graphic>
                        </Button>
                        <Separator orientation="VERTICAL" />

                        <HBox alignment="CENTER" spacing="5">
                            <Button fx:id="btnSkipStart" onAction="#onSkipToStart"
                                    style="-fx-background-color: transparent; -fx-text-fill: white; -fx-cursor: hand;" />

                            <Button onAction="#onPlayPause" fx:id="btnPlayPause" text="â–¶"
                                    style="-fx-background-radius: 20; -fx-min-width: 40;" />

                            <Button fx:id="btnSkipEnd" onAction="#onSkipToEnd"
                                    style="-fx-background-color: transparent; -fx-text-fill: white; -fx-cursor: hand;" />
                        </HBox>

                        <Label fx:id="lblTime" text="00:00 / 00:00" textFill="WHITE" style="-fx-font-family: monospace; -fx-font-size: 14;" />

                        <Region HBox.hgrow="ALWAYS" />

                        <Label text="Zoom:" textFill="GRAY" />
                        <Slider fx:id="zoomSlider" min="10" max="200" value="50" blockIncrement="10" prefWidth="100" />
                    </children>
                </HBox>

                <VBox style="-fx-background-color: transparent;">
                    <children>
                        <VBox style="-fx-background-color: #111; -fx-padding: 10;" BorderPane.alignment="CENTER" spacing="10">
                            <children>
                                <VBox style="-fx-background-color: transparent;">
                                    <children>
                                        <StackPane alignment="CENTER">
                                            <Canvas fx:id="timelineCanvas" height="110.0" width="1000.0" />

                                            <ProgressIndicator fx:id="loadingSpinner"
                                                               visible="false"
                                                               maxWidth="40" maxHeight="40"
                                                               style="-fx-progress-color: #3b82f6;"/>
                                        </StackPane>

                                        <ScrollBar fx:id="timelineScroll" orientation="HORIZONTAL" min="0" max="100"
                                                   style="-fx-background-color: transparent;" />
                                    </children>
                                </VBox>
                            </children>
                        </VBox>
                    </children>
                </VBox>
            </children>
        </VBox>
    </bottom>

</BorderPane>