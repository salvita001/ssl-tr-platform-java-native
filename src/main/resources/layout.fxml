<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.canvas.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.ssltrainingplatform.controller.EditorController"
            styleClass="main-bg" stylesheets="@style.css">

    <center>
        <StackPane fx:id="container">
            <children>
                <ImageView fx:id="videoView" preserveRatio="true" />
                <Canvas fx:id="drawCanvas" />

                <VBox fx:id="placeholderView" alignment="CENTER" spacing="20" onMouseClicked="#onImportVideo" style="-fx-cursor: hand;">
                    <children>
                        <StackPane style="-fx-background-color: white; -fx-background-radius: 50; -fx-min-width: 60; -fx-min-height: 60; -fx-max-width: 60; -fx-max-height: 60;">
                            <children>
                                <Region fx:id="iconPlaceholder" maxWidth="30" maxHeight="20" style="-fx-background-color: #4a5568;" />
                            </children>
                        </StackPane>
                        <Label text="Haz clic en el icono o arrastra un video aquí."
                               style="-fx-text-fill: #888; -fx-font-size: 14px; -fx-font-weight: normal;" />
                    </children>
                </VBox>

                <VBox maxWidth="100" alignment="TOP_CENTER" spacing="10"
                      StackPane.alignment="CENTER_LEFT" styleClass="tool-sidebar">
                    <StackPane.margin>
                        <Insets left="20" />
                    </StackPane.margin>
                    <children>
                        <Label text="TOOLS" styleClass="sidebar-label" />

                        <GridPane hgap="8" vgap="8" alignment="CENTER">
                            <children>
                                <ToggleButton fx:id="btnCursor" onAction="#setToolCursor" prefWidth="42" prefHeight="42" styleClass="tool-button" selected="true" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                    <toggleGroup><ToggleGroup fx:id="toolsGroup"/></toggleGroup>
                                </ToggleButton>
                                <ToggleButton fx:id="btnArrow" onAction="#setToolArrow" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                                <ToggleButton fx:id="btnArrowDashed" onAction="#setToolArrowDashed" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                <ToggleButton fx:id="btnArrow3D" onAction="#setToolArrow3D" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                                <ToggleButton fx:id="btnText" onAction="#setToolText" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                                <ToggleButton fx:id="btnPen" onAction="#setToolPen" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                                <ToggleButton fx:id="btnPolygon" onAction="#setToolPolygon" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                                <ToggleButton fx:id="btnZoomCircle" onAction="#setToolZoomCircle" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                                <ToggleButton fx:id="btnZoomRect" onAction="#setToolZoomRect" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                                <ToggleButton fx:id="btnTracking" onAction="#setToolTracking" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="1" GridPane.rowIndex="4"/>

                                <ToggleButton fx:id="btnWall" onAction="#setToolWall" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="0" GridPane.rowIndex="5"/>
                                <ToggleButton fx:id="btnSpotlight" onAction="#setToolSpotlight" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="1" GridPane.rowIndex="5"/>

                                <ToggleButton fx:id="btnBase" onAction="#setToolBase" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="0" GridPane.rowIndex="6"/>
                                <ToggleButton fx:id="btnRectShaded" onAction="#setToolRectShaded" prefWidth="42" prefHeight="42" styleClass="tool-button" toggleGroup="$toolsGroup" GridPane.columnIndex="1" GridPane.rowIndex="6"/>
                            </children>
                        </GridPane>

                        <Separator opacity="0.1" />

                        <VBox alignment="CENTER" spacing="5">
                            <children>
                                <HBox alignment="CENTER" spacing="10">
                                    <children>
                                        <Label text="COLOR" styleClass="sidebar-label" />
                                        <ColorPicker fx:id="colorPicker" style="-fx-color-label-visible: false;" />
                                    </children>
                                    <padding>
                                        <Insets top="5" bottom="5" />
                                    </padding>
                                </HBox>
                            </children>
                        </VBox>

                        <Separator opacity="0.1" />
                        <Label text="GROSOR" styleClass="sidebar-label" />
                        <HBox spacing="8" alignment="CENTER" styleClass="thickness-bar">
                            <children>
                                <ToggleButton onAction="#setThicknessSmall" styleClass="dot-button, dot-small">
                                    <toggleGroup><ToggleGroup fx:id="thicknessGroup"/></toggleGroup>
                                </ToggleButton>
                                <ToggleButton onAction="#setThicknessMed" styleClass="dot-button, dot-med" toggleGroup="$thicknessGroup" selected="true" />
                                <ToggleButton onAction="#setThicknessLarge" styleClass="dot-button, dot-large" toggleGroup="$thicknessGroup" />
                                <ToggleButton onAction="#setThicknessExtra" styleClass="dot-button, dot-extra" toggleGroup="$thicknessGroup" />
                            </children>
                        </HBox>
                    </children>
                </VBox>

                <TextField fx:id="floatingInput" visible="false" style="-fx-background-color: rgba(0,0,0,0.7); -fx-text-fill: white;" maxWidth="200" />
            </children>
        </StackPane>
    </center>

    <bottom>
        <VBox spacing="10" style="-fx-padding: 10 20 20 20;">
            <children>
                <HBox alignment="CENTER" styleClass="bottom-bar-container">
                    <children>
                        <HBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS" spacing="15">
                            <children>
                                <Label text="Zoom Timeline:" styleClass="control-label" />
                                <Slider fx:id="zoomSlider" min="5" value="10" prefWidth="120" />

                                <Separator orientation="VERTICAL" opacity="0.1" prefHeight="20" />

                                <Label text="Edición: " styleClass="control-label" />

                                <Label fx:id="lblTime" text="00:00 - 00:00" styleClass="time-label" />
                            </children>
                        </HBox>

                        <HBox alignment="CENTER" spacing="20">
                            <children>
                                <Button fx:id="btnSkipStart" onAction="#onSkipToStart" styleClass="transport-btn" />
                                <Button fx:id="btnPlayPause" onAction="#onPlayPause" text="▶" styleClass="transport-btn" style="-fx-font-size: 24; -fx-text-fill: #7c3aed;" />
                                <Button fx:id="btnSkipEnd" onAction="#onSkipToEnd" styleClass="transport-btn" />
                                <Separator orientation="VERTICAL" opacity="0.1" prefHeight="20" />
                                <Button fx:id="btnUndo" onAction="#onUndo" styleClass="transport-btn" />
                                <Button fx:id="btnRedo" onAction="#onRedo" styleClass="transport-btn" />
                            </children>
                        </HBox>

                        <HBox alignment="CENTER_RIGHT" HBox.hgrow="ALWAYS">
                            <children>
                                <Button text="Exportar Vídeo" onAction="#onExportVideo" styleClass="action-btn" />
                            </children>
                        </HBox>
                    </children>
                </HBox>

                <VBox styleClass="timeline-container">
                    <children>
                        <StackPane alignment="CENTER">
                            <children>
                                <Canvas fx:id="timelineCanvas" height="100.0" width="1200.0" />
                                <ProgressIndicator fx:id="loadingSpinner" visible="false" maxWidth="40" />
                            </children>
                        </StackPane>
                        <ScrollBar fx:id="timelineScroll" orientation="HORIZONTAL" visible="false" managed="false" />
                    </children>
                </VBox>
            </children>
        </VBox>
    </bottom>
</BorderPane>